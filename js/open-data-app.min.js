$(document).ready(function(){var a=[];if(document.getElementById("map")){var d={center:new google.maps.LatLng(45.423494,-75.697933),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP};var f=new google.maps.Map(document.getElementById("map"),d);var c;$(".list > li").each(function(){var i=$(this).find("a").html();var m='<div class="info-window"><strong>'+i+'</strong><a href="skateboardpark/'+$(this).attr("data-id")+'#rate">Rate This!</a></div>';var k=parseFloat($(this).find('meta[itemprop="longitude"]').attr("content"));var l=parseFloat($(this).find('meta[itemprop="latitude"]').attr("content"));var n=new google.maps.LatLng(l,k);a.push({id:$(this).attr("data-id"),lat:l,lng:k});var h=new google.maps.Marker({position:n,map:f,title:i,icon:"/images/marker.png",animation:google.maps.Animation.DROP});function j(o){if(o.preventDefault){o.preventDefault()}if(c){c.close()}c=new google.maps.InfoWindow({content:m});c.open(f,h)}google.maps.event.addListener(h,"click",j);google.maps.event.addDomListener($(this).children("a").get(0),"click",j)})}var g=$(".rater-usable li");console.log(g);g.on("mouseenter",function(j){var k=$(this).index();for(var h=0;h<k;h++){g.eq(h).addClass("is-rated-hover")}}).on("mouseleave",function(h){g.removeClass("is-rated-hover")});var b;function e(o,p){var r=[],h=a.length,q=new google.maps.LatLng(o,p);if(b){b.setPosition(q)}else{b=new google.maps.Marker({position:q,map:f,title:"You are here.",icon:"/images/new.png",animation:google.maps.Animation.DROP})}f.setCenter(q);var n=new LatLon(o,p);for(var m=0;m<h;m++){r.push({id:a[m].id,distance:parseFloat(n.distanceTo(new LatLon(a[m].lat,a[m].lng)))})}r.sort(function(j,i){return j.distance-i.distance});var l=$(".list");for(var k=0;k<h;k++){$li=l.find('[data-id="'+r[k].id+'"]');$li.find(".distance").html(r[k].distance.toFixed(1)+"km");l.append($li)}}if(navigator.geolocation){$("#submitaddr").click(function(){$("#geo-form").submit()});$("#geo").click(function(){navigator.geolocation.getCurrentPosition(function(h){e(h.coords.latitude,h.coords.longitude)})})}$("#geo-form").on("submit",function(h){h.preventDefault();console.log("form");var i=new google.maps.Geocoder();i.geocode({address:$("#adr").val()+"Ottawa, ON",region:"CA"},function(k,j){if(j==google.maps.GeocoderStatus.OK){e(k[0].geometry.location.lat(),k[0].geometry.location.lng())}})})});